# Phase 1: 基础渲染功能 TODO 列表

## 项目设置

### ✅ 项目初始化
- [x] 创建项目目录结构
- [x] 编写项目文档
- [x] 配置 SDL3 依赖（third_party 中已有）

### ✅ 构建设置
- [x] 创建 CMakeLists.txt 配置
  - [x] 配置 C++17 标准
  - [x] 添加 SDL3 依赖（third_party/SDL）
  - [x] 添加 Eigen3 依赖（third_party/eigen-3.4.0）
  - [x] 添加 OpenGL 库
  - [x] 配置编译选项
- [x] 创建 src/ 目录结构
- [x] 创建 include/ 目录结构
- [x] 创建 tests/ 目录

---

## 核心基础设施

### ✅ OpenGL 抽象层
- [x] 创建 OpenGL 上下文管理
  - [x] OpenGLContext 类
  - [x] 窗口创建（SDL3）
  - [x] 上下文初始化
  - [x] 扩展检测
  - [x] 版本检测（确保 OpenGL 4.5+）
  
### ✅ 着色器系统
- [x] Shader 基类实现
  - [x] 着色器源码读取
  - [x] 顶点着色器编译
  - [x] 片段着色器编译
  - [x] 几何着色器编译（已测试）
  - [x] 程序链接
  - [x] Uniform 设置接口（UniformManager）
  - [x] 错误处理和日志
- [x] UniformManager 实现
  - [x] Uniform 位置缓存
  - [x] 支持多种数据类型（int, float, vec2/3/4, mat3/4）
  - [x] Uniform 自动扫描和列出
- [x] 着色器资源管理
  - [x] 着色器缓存系统（ShaderCache）
  - [x] 重载支持（Reload方法）
  - [x] 资源引用计数（shared_ptr）
  - [x] 着色器预编译

### ✅ 状态管理
- [x] RenderState 类
  - [x] 深度测试控制
  - [x] 混合模式控制
  - [x] 面剔除控制
  - [x] 视口设置
  - [x] 裁剪区域设置
  - [x] 状态缓存和优化
- [x] OpenGL 状态封装
  - [x] 基础状态管理
  - [x] 纹理绑定管理（支持32个纹理单元）
  - [x] 缓冲区绑定管理（VAO, VBO, EBO, UBO, SSBO）
  - [x] 着色器程序管理（自动缓存切换）

---

## 资源管理系统

### ✅ 纹理管理
- [x] Texture 类
  - [x] 纹理加载（使用 SDL_image）
  - [x] 纹理创建（运行时生成）
  - [x] 纹理参数设置
  - [x] Mipmap 生成
  - [x] 纹理释放
- [x] TextureLoader
  - [x] 纹理缓存机制
  - [x] 异步加载支持
  - [x] 错误处理
- [x] 支持格式：PNG, JPG, BMP, TGA

### ✅ 网格管理
- [x] Vertex 数据结构
  ```cpp
  struct Vertex {
      Vector3 position;
      Vector2 texCoord;
      Vector3 normal;
      Color color;
  };
  ```
- [x] Mesh 类
  - [x] 顶点数据设置
  - [x] 索引数据设置
  - [x] VBO/VAO 创建
  - [x] 绘制接口（Draw, DrawInstanced）
  - [x] 内存管理
  - [x] 法线/切线重计算
  - [x] 包围盒计算
- [x] MeshLoader
  - [x] 基础网格创建接口
  - [x] 几何形状生成（立方体、球体、圆柱、圆锥、圆环、胶囊、平面、四边形、三角形、圆形）
  - [x] 文件加载（OBJ, FBX, GLTF, Collada, Blender, 3DS, PLY, STL）✅ 已完成

### ✅ 材质管理
- [x] Material 类
  - [x] 材质属性（环境色、漫反射、镜面反射、自发光）
  - [x] 纹理引用（支持多纹理）
  - [x] 着色器引用
  - [x] 渲染状态（混合、剔除、深度）
  - [x] 物理材质属性（金属度、粗糙度、镜面反射强度）
  - [x] 自定义 uniform 参数
- [x] MaterialManager（暂不实现，使用 shared_ptr 直接管理）
  - [x] 材质生命周期管理（通过 shared_ptr）

### ✅ 资源管理器（ResourceManager）
- [x] 资源注册机制
- [x] 引用计数
- [x] 自动释放机制
- [x] 资源统计和监控
- [x] 统一管理纹理、网格、材质、着色器
- [x] 线程安全实现
- [x] 批量操作接口
- [x] ForEach遍历功能

---

## 渲染核心

### ✅ Renderer 主类
- [x] Renderer 实现
  - [x] 初始化（Initialize）
  - [x] 清理（Shutdown）
  - [x] 帧开始（BeginFrame）
  - [x] 帧结束（EndFrame）
  - [x] 呈现（Present）
  - [x] 清屏（Clear）
- [x] 窗口管理
  - [x] 窗口创建
  - [x] 窗口大小控制
  - [x] 全屏支持
  - [x] VSync 控制
  - [x] 窗口事件处理（由 SDL3 提供）
- [x] 渲染统计
  - [x] Draw Call 计数（框架已准备）
  - [x] 三角形计数（框架已准备）
  - [x] FPS 统计
  - [x] 帧时间统计

### 相机系统
- [ ] Camera 类
  - [ ] 透视投影
  - [ ] 正交投影
  - [ ] 视图变换矩阵
  - [ ] 投影变换矩阵
  - [ ] 视锥体
- [ ] 相机控制
  - [ ] 第一人称相机
  - [ ] 第三人称相机
  - [ ] 轨道相机
  - [ ] 相机移动和旋转
- [ ] 多相机支持（可选）

### 渲染对象抽象
- [ ] Renderable 基类
  - [ ] 变换矩阵
  - [ ] 可见性控制
  - [ ] 渲染接口
- [ ] MeshRenderable 类
  - [ ] 网格引用
  - [ ] 材质设置
  - [ ] 渲染实现

---

## 2D 渲染

### 精灵系统
- [ ] Sprite 类
  - [ ] 纹理引用
  - [ ] 裁剪区域（UV坐标）
  - [ ] 颜色混合
  - [ ] 缩放和平移
- [ ] SpriteRenderer
  - [ ] 精灵批处理
  - [ ] 2D变换
  - [ ] 渲染优化

### 文本渲染
- [ ] Font 类
  - [ ] 字体加载（SDL_ttf）
  - [ ] 字体大小控制
  - [ ] 字符纹理缓存
- [ ] Text 类
  - [ ] 文本内容设置
  - [ ] 文本颜色
  - [ ] 文本对齐
  - [ ] 换行支持（可选）
- [ ] TextRenderer
  - [ ] 文本批处理
  - [ ] 文本渲染

---

## 3D 渲染

### 模型渲染
- [ ] Model 类
  - [ ] 网格集合
  - [ ] 材质绑定
  - [ ] 变换矩阵
- [ ] ModelRenderer
  - [ ] 模型加载接口
  - [ ] 模型渲染
  - [ ] 模型变换

### 基本几何形状
- [ ] 预定义网格生成器
  - [ ] 立方体（Cube）
  - [ ] 球体（Sphere）
  - [ ] 平面（Plane）
  - [ ] 圆锥（Cone）
  - [ ] 圆柱（Cylinder）

---

## 光照系统（基础）

### 光源类型
- [ ] Light 基类
  - [ ] 光源颜色
  - [ ] 光源强度
- [ ] DirectionalLight（定向光）
  - [ ] 方向设置
  - [ ] 光照计算
- [ ] PointLight（点光源）
  - [ ] 位置设置
  - [ ] 范围设置
  - [ ] 衰减计算
- [ ] SpotLight（聚光灯）
  - [ ] 位置和方向
  - [ ] 内角和外角
  - [ ] 衰减计算
- [ ] AmbientLight（环境光）
  - [ ] 环境光颜色和强度

### 光照管理器
- [ ] LightManager 类
  - [ ] 光源注册
  - [ ] 最大光源数限制（建议4-8个）
  - [ ] 光照数据上传到着色器
  - [ ] 光源排序（按重要性）

---

## 渲染层级系统

### RenderLayer 类
- [ ] 层级创建和销毁
- [ ] 优先级设置
- [ ] 启用/禁用控制
- [ ] 渲染对象添加/移除
- [ ] 层级排序功能

### 渲染队列
- [ ] RenderQueue 类
  - [ ] 按优先级排序
  - [ ] 按材质排序
  - [ ] 按深度排序
- [ ] 渲染提交机制
  - [ ] Submit 接口
  - [ ] Flush 接口

### 层级属性配置
- [ ] 深度测试配置
- [ ] 混合模式配置
- [ ] 面剔除配置
- [ ] 视口配置

---

## 数学库集成

### ✅ 数学数据结构
- [x] Vector2, Vector3, Vector4
- [x] Matrix3, Matrix4
- [x] Quaternion
- [x] Color（RGBA）
- [x] Rect, AABB
- [ ] Plane, Ray

### 数学工具函数
- [x] 矩阵运算（使用 Eigen）
- [x] 向量运算
- [x] 四元数运算
- [ ] 变换计算

### Transform 类
- [ ] 位置、旋转、缩放
- [ ] 本地和世界变换
- [ ] 父子关系（可选）

---

## 基础工具

### ✅ 日志系统
- [x] Logger 类
  - [x] 日志级别（Debug, Info, Warning, Error）
  - [x] 文件输出（自动创建 logs 文件夹）
  - [x] 时间戳命名（每次运行新日志文件）
  - [x] 控制台输出
  - [x] 格式化日志

### ✅ 文件系统
- [x] FileUtils
  - [x] 文件读取
  - [x] 路径处理
  - [x] 资源路径管理

### 配置系统（可选）
- [ ] Config 类
  - [ ] 配置文件读取
  - [ ] 设置项管理
  - [ ] 默认值设置

---

## 示例程序

### 基础测试
- [x] 创建窗口测试 (01_basic_window)
- [x] 着色器加载和编译测试 (02_shader_test)
- [x] 几何着色器和缓存系统测试 (03_geometry_shader_test)
- [x] OpenGL 状态管理测试 (04_state_management_test) - 展示状态缓存和三角形渲染
- [x] 纹理加载和渲染测试 (05_texture_test) - 纹理系统和 TextureLoader
- [x] 网格管理系统测试 (06_mesh_test) - 10种几何形状生成和渲染（立方体、球体、圆柱、圆锥等）
- [x] 模型文件加载测试 (11_model_loader_test) - 外部模型加载（OBJ/FBX/GLTF等）
- [x] 材质系统测试 (12_material_test) - 材质属性、纹理、渲染状态测试 ✅ 已完成
- [x] 资源管理器测试 (15_resource_manager_test) - 统一资源管理、引用计数、自动清理 ✅ 已完成
- [x] 资源管理器线程安全测试 (16_resource_manager_thread_safe_test) - 多线程并发访问测试 ✅ 已完成
- [ ] 光照测试

### 综合示例
- [ ] Simple Scene - 基础3D场景
  - [ ] 相机控制
  - [ ] 多个物体
  - [ ] 光照渲染
- [ ] 2D Demo
  - [ ] 精灵渲染
  - [ ] 文本显示
  - [ ] UI元素

---

## 测试

### 单元测试
- [ ] 数学库测试
- [ ] 资源管理测试
- [ ] 着色器编译测试
- [ ] 渲染管线测试

### 集成测试
- [ ] 场景渲染测试
- [ ] 性能基准测试
- [ ] 内存泄漏检测

---

## 文档更新

### 代码文档
- [ ] 核心类文档注释
- [ ] API 文档更新
- [ ] 使用示例代码

### 开发文档
- [ ] 更新开发指南
- [ ] 添加快速开始示例
- [ ] API 使用示例

---

## 性能优化（基础）

### 渲染优化
- [ ] 减少状态切换
- [ ] 绘制调用批处理
- [ ] 纹理绑定优化
- [ ] 着色器程序缓存

### 内存优化
- [ ] 对象池（Object Pooling）
- [ ] 资源内存管理
- [ ] 内存统计

---

## 依赖项使用

### ✅ SDL3
- [x] 窗口创建
- [x] 事件处理
- [x] 定时器
- [ ] 音频（可选，后续）

### ✅ Eigen3
- [x] 矩阵运算
- [x] 向量运算
- [x] 四元数运算
- [x] 线性代数功能

### ✅ Assimp
- [x] 外部模型文件加载（OBJ, FBX, GLTF, Collada, Blender, 3DS, PLY, STL）
- [x] 自动三角化和法线生成
- [x] 网格优化和后处理
- [x] 多网格模型支持

---

## 里程碑检查点

### Milestone 1: 基础框架 ✅ 已完成
- [x] 项目构建成功
- [x] 窗口创建和渲染
- [x] 基础着色器加载
- [x] 着色器缓存系统
- [x] 几何着色器支持
- [x] 网格渲染（Mesh 和 MeshLoader）

### Milestone 2: 基础渲染
- [x] 纹理渲染
- [x] 材质系统 ✅ 已完成
- [ ] 相机系统
- [ ] 光照系统

### Milestone 3: 2D 和层级
- [ ] 精灵渲染
- [ ] 文本渲染
- [ ] 层级系统
- [ ] 完整示例程序

### Milestone 4: 完善和测试
- [ ] 所有基础功能测试通过
- [ ] 文档完善
- [ ] 性能基准测试
- [ ] 准备进入 Phase 2

---

## 开发建议

### 优先级排序
1. **高优先级**: 项目结构、OpenGL抽象、基础渲染
2. **中优先级**: 资源管理、2D渲染、光照系统
3. **低优先级**: 高级特性、优化、工具

### 开发顺序
1. 设置 CMakeLists.txt 和项目结构
2. 实现 OpenGL 抽象层
3. 实现着色器系统
4. 实现基础 Mesh 渲染
5. 实现相机系统
6. 实现光照系统
7. 实现 2D 渲染
8. 实现渲染层级
9. 编写示例和测试
10. 文档和优化

### 注意事项
- 确保 OpenGL 上下文正确管理
- 注意资源生命周期管理
- 编写清晰的错误处理
- 保持代码模块化
- 及时更新文档

---

**完成标准**：能够渲染一个包含光照的3D场景，支持2D元素叠加，具备完整的渲染层级管理。

[返回文档首页](../README.md)

